<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <title>Monthly Report</title>

    <style>
        @media print {
            @page { size: landscape; margin: 2mm; }

            table, tr, td, th {
                page-break-inside: avoid !important;
            }
        }
    </style>
</head>

<body>
<div class="p-1 container d-flex flex-column align-items-center mt-5">
    <h2 class="text-center mb-4">Monthly Report</h2>
    <p class="ms-2 text-muted fs-6">From: {{ from_date }} To: {{ to_date }}</p>

    <div class="bg-light container p-3 mb-4 rounded-3">
        <h4 class="mb-3">Summary</h4>

        <p><strong>Doctor:</strong> {{ doctor }}</p>
        <p><strong>Total:</strong> {{ appts | length }}</p>
        <p><strong>Completed:</strong>
            {{ appts | selectattr("status", "equalto", "completed") | list | length }}
        </p>
        <p><strong>Cancelled:</strong>
            {{ appts | selectattr("status", "equalto", "cancelled") | list | length }}
        </p>
    </div>

    <h5 class="mb-4">Detailed Report</h5>

    <div class="table-responsive">
        <table class="table table-bordered">
            <thead class="table-dark">
            <tr>
                <th>Sr</th>
                <th>Patient</th>
                <th>Date</th>
                <th>Status</th>
                <th>Test</th>
                <th>Diag</th>
                <th>Med</th>
                <th>Dose</th>
                <th>Dur</th>
            </tr>
            </thead>

            <tbody>
            {% for a in appts %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ a.patient }}</td>
                <td>{{ a.date }}</td>

                <td class="{{ 'text-success' if a.status == 'completed' else 'text-danger' }}">
                    {% if a.status == 'completed' %}
                    <i class="bi bi-check-lg"></i>
                    {% else %}
                    <i class="bi bi-x"></i>
                    {% endif %}
                </td>

                {% if a.status == 'completed' %}
                    <td>{{ a.tests }}</td>
                    <td>{{ a.diagnosis }}</td>

                    {% if a.prescriptions %}
                        {% for p in a.prescriptions %}
                        <td>{{ p.med }}</td>
                        <td>{{ p.dose }}</td>
                        <td>{{ p.duration }}</td>
                        {% endfor %}
                    {% else %}
                        <td colspan="3" class="text-center">No Prescription</td>
                    {% endif %}

                {% else %}
                    <td colspan="5" class="text-center">N/A</td>
                {% endif %}
            </tr>
            {% endfor %}
            </tbody>

        </table>
    </div>
    <div class="mb-5">
        <small class="text-muted">Generated by HealthLink HMS</small>  
    </div>
</div>
</body>
</html>
